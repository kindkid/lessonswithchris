<html>
  <head>
    <style>
      #blah {
       border: 1px solid black;
      }
    </style>
    <script>
      PIXELS = 600
      SCALE = 1
      TOO_FAR = 100000000
      GLOBAL_SHIFT = .546
      ITERATIONS = 100
      //take a double between 0 and 1 and returns integer between 0 and 255
      var projection = function(d) {
        return  Math.round(255* d)
      }
      // d is a double between 0 and 1
      var makeColorComponent = function(d) {
        r= projection(d).toString(16)
        if (r.length < 2)
          r = "0" + r
        return r
      }
      var cycleMap = function (x,shift,width) {
        return Math.sin((x + shift * width) * Math.PI * 2/width)/2 + 0.5;
      }
      //r,g,b are floats/doubles between 0 and 1
      var makeColor = function(r,g,b) {
        return "#" + makeColorComponent(r) + makeColorComponent(g) + makeColorComponent(b)       
      }
      var transform = function(x, pixels, minplot, maxplot) {
        return minplot + (x/pixels * (maxplot - minplot))
      }
      var xTransform = function(x, pixels, minplot, maxplot) {
        return transform(x,pixels,minplot,maxplot);
      }
      var yTransform = function(y, pixels, minplot, maxplot) {
        return -transform(y,pixels,-minplot,-maxplot);
      }
      var doit = function() {
        var tmp, zx, zy, x, y, sqrDistance, p;
        var r = document.getElementById("blah");
        var ctx = r.getContext("2d");
        var drawPixel = function(x,y) {
          ctx.fillRect(x*SCALE, y*SCALE, SCALE, SCALE);
        }
        var colsByColor = [];
        var rowsByColor = [];
        var yTransforms = [];

        for (i=0; i<ITERATIONS; i++) {
          colsByColor[i] = [];
          rowsByColor[i] = [];
        }
        for (c=0; c < PIXELS/SCALE; c++) {
          x = xTransform(c, PIXELS/SCALE, -2, 1)
          for (r=0; r < PIXELS/SCALE; r++) {
            if (c == 0) {
              yTransforms[r] = yTransform(r, PIXELS/SCALE, -1.5, 1.5);
            }
            y = yTransforms[r];
            zx = x
            zy = y
            for (i = 0; i<ITERATIONS; i++) {
              // z = z*z
              tmp = zx*zx - zy*zy
              zy = 2*zx*zy
              zx = tmp

              // z = z + p
              zx = zx + x
              zy = zy + y

              //distance squared
              tmp = y-zy
              sqrDistance = tmp*tmp
              tmp = x-zy
              sqrDistance = sqrDistance + tmp*tmp;
              //sqrDistance = ((y-zy) * (y-zy) + (x-zx) * (x-zx));

              if (sqrDistance >= TOO_FAR) {
                colsByColor[i].push(c);
                rowsByColor[i].push(r);
              }
            }
          }
        }
        for (i=0; i<ITERATIONS; i++) {
          if (i in colsByColor) {
            var red = cycleMap(i,GLOBAL_SHIFT,ITERATIONS)
            var green = cycleMap(i,GLOBAL_SHIFT + 0.333333,ITERATIONS)
            var blue = cycleMap (i,GLOBAL_SHIFT + 0.666666,ITERATIONS)
            var color = makeColor(red, green, blue);
            var cols = colsByColor[i];
            var rows = rowsByColor[i];
            var len = cols.length;
            for (var j=0; j < len; j++) {
              var c = cols[j];
              var r = rows[j];
              ctx.fillStyle = color;
              ctx.fillRect(c*SCALE, r*SCALE, SCALE, SCALE);
            }
          }
        }
      }
    </script>
  </head>
  <body onload="doit()">
    <canvas id="blah" width="600" height="600"></canvas>
  </body>
</html>
